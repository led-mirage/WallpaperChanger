# WallpaperChanger 仕様書

© 2025 led-mirage

## 🔖 プログラム概要

### プログラム名

**WallpaperChanger.exe**

### 機能

指定されたフォルダから画像をランダムに１枚選択し、明るさ補正を行ったうえで Windows の壁紙に設定する

### 動作環境

- Windows 11
- Python 3.11以上（開発時は3.13.9で検証）

### 処理フロー

1. 設定ファイルまたは起動引数から設定値を読み込む
2. 指定フォルダ内の画像を検索し、ランダムに１枚を選択
3. 選択した画像に明るさ補正をかけて、Windowsのテンポラリフォルダに保存
4. overlayオプションが有効な場合は、ファイル情報を画像に描画する
5. 保存したファイルをWindowsの壁紙に設定

### 対応画像

以下の拡張子のファイルを検索する。

".jpg", ".jpeg", ".png", ".bmp", ".webp"

### 特記事項

- サブフォルダも検索する
- 明るさ補正、ファイル情報の描画を行う際、元の画像は変更しない
- 壁紙の配置方法はOSの設定に任せる

## 🔖 コマンドライン

```bash
usage: WallpaperChanger.exe
    [-h] [--dir DIR] [--brightness BRIGHTNESS] [--temp TEMP] [--overlay] [--overlay-text OVERLAY_TEXT]
    [--overlay-font-size OVERLAY_FONT_SIZE] [--overlay-margin-x OVERLAY_MARGIN_X]
    [--overlay-margin-y OVERLAY_MARGIN_Y] [--version]
    [config]
```

| オプション | 型 | 説明 | デフォルト値 |
|-|-|-|-|
| --h | | 使い方を表示 | |
| --dir | str | 画像フォルダを指定（複数可） | |
| --brightness | float | 明るさ補正値（0.0～2.0）| 1.0 |
| --temp | str | TEMP に保存するファイル名 | wallpaper_temp.png |
| --overlay | | ファイル情報を画像上に重ねて表示する場合に指定 | |
| --overlay-text | str | ファイル情報の表示内容（filename / parent_and_filename / fullpath） | filename |
| --overlay-font-size | int | フォントサイズ（px） | 16 |
| --overlay-margin-x | int | 表示位置の横方向のマージン（px） | 50 |
| --overlay-margin-y | int | 表示位置の縦方向のマージン（px） | 100 |
| --version | | バージョン情報を表示 | |
| config | path | 設定ファイルのパス | |

### 特記事項

- --versionがあったら情報を表示して即終了
- configがある場合は設定ファイルを優先して他のパラメータは無視

## 🔖 設定ファイル

- ファイル名: config.yaml（任意）  
- ファイル形式: YAML  
- 設定項目  
    - image_dirs: list[str]  
        - 画像を検索するフォルダ  
    - brightness: float  
        - 明るさ補正値（0.0～2.0）  
        - 0.8は原画の80%の明るさ  
    - temp_filename: str  
        - テンポラリファイル名  
        - png形式推奨  
    - overlay: object  
        - 画像上にテキストを重ねて表示する設定  
        - enabled: bool  
            - テキストオーバーレイを有効にするかどうか  
        - text: str  
            - 表示する文字列の種類  
            - filename: ファイル名のみ  
            - parent_and_filename: 親フォルダ名 + ファイル名  
            - fullpath: フルパス  
        - font_size: int  
            - フォントサイズ（px）  
        - margin_x: int  
            - 右端からの余白（px）  
        - margin_y: int  
            - 下端からの余白（px）  

【設定例】

```yaml
# 壁紙があるフォルダ（複数可）
image_dirs:
  - 'C:\Users\UserA\Desktop\Wallpapers'
  - 'C:\temp\images'

# 壁紙の明るさ (0.0～2.0 : 1.0は明るさ100%)
brightness: 0.8

# テンポラリファイル名（Windows の %TEMP% に保存される）
temp_filename: 'wallpaper_temp.png'

# 画像上に表示するテキストオーバーレイの設定
overlay:
  enabled: true
  text: filename              # filename | parent_and_filename | fullpath
  font_size: 16               # px（int）
  margin_x: 50                # 右端からの余白（px）
  margin_y: 100               # 下端からの余白（px）
```

## 🔖 終了コード

- 0: 正常終了
- 1: 起動引数の間違い
- 2: 実行時エラー

## 🔖 エラーログ

実行時エラーが発生した場合 `error.log` が生成される。
ファイルが既にある場合は末尾に追記される。

ファイル生成場所は `config.yaml` と同じフォルダ。  
設定ファイルを使用しない場合は、カレントフォルダに生成される。

サンプル：

```log
[2025-12-08 21:36:56] Error: 'No images available to pick.'
```
